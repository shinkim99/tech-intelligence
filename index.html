<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tech Intelligence Config Manager</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #1a1a2e;
            color: #eee;
            min-height: 100vh;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        
        h1 {
            text-align: center;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 10px;
            margin-bottom: 20px;
        }
        
        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .tab-btn {
            padding: 12px 24px;
            border: none;
            background: #2d2d44;
            color: #aaa;
            border-radius: 8px 8px 0 0;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
        }
        
        .tab-btn.active {
            background: #3d3d5c;
            color: #fff;
        }
        
        .tab-btn:hover {
            background: #3d3d5c;
        }
        
        .tab-content {
            display: none;
            background: #2d2d44;
            padding: 20px;
            border-radius: 0 10px 10px 10px;
        }
        
        .tab-content.active {
            display: block;
        }
        
        /* ë¶„ì•¼ ì„¤ì • */
        .domain-card {
            background: #3d3d5c;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            border-left: 4px solid #667eea;
        }
        
        .domain-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .domain-name {
            font-size: 18px;
            font-weight: bold;
            color: #667eea;
        }
        
        .domain-priority {
            background: #667eea;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
        }
        
        .domain-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
            margin-top: 10px;
        }
        
        .detail-item {
            background: #2d2d44;
            padding: 8px 12px;
            border-radius: 4px;
        }
        
        .detail-label {
            font-size: 11px;
            color: #888;
            margin-bottom: 4px;
        }
        
        .detail-value {
            font-size: 13px;
        }
        
        /* í¼ ìŠ¤íƒ€ì¼ */
        .form-group {
            margin-bottom: 15px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 5px;
            color: #aaa;
            font-size: 13px;
        }
        
        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #444;
            border-radius: 6px;
            background: #1a1a2e;
            color: #eee;
            font-size: 14px;
        }
        
        .form-group textarea {
            min-height: 80px;
            resize: vertical;
        }
        
        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }
        
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .btn-success {
            background: #27ae60;
            color: white;
        }
        
        .btn-danger {
            background: #e74c3c;
            color: white;
        }
        
        .btn-secondary {
            background: #555;
            color: white;
        }
        
        .btn:hover {
            opacity: 0.9;
            transform: translateY(-1px);
        }
        
        .btn-group {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }
        
        /* ê²°ê³¼ í…Œì´ë¸” */
        .results-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }
        
        .results-table th,
        .results-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #444;
        }
        
        .results-table th {
            background: #3d3d5c;
            color: #667eea;
            font-weight: 600;
        }
        
        .results-table tr:hover {
            background: #3d3d5c;
        }
        
        /* ìƒíƒœ ë±ƒì§€ */
        .badge {
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 11px;
            font-weight: 600;
        }
        
        .badge-high { background: #e74c3c; }
        .badge-medium { background: #f39c12; }
        .badge-low { background: #27ae60; }
        
        .action-badge {
            padding: 4px 10px;
            border-radius: 4px;
            font-size: 11px;
        }
        
        .action-ì ê·¹ì§„ì¶œ { background: #27ae60; }
        .action-ì„ ë³„ì§„ì¶œ { background: #3498db; }
        .action-ê´€ë§ { background: #f39c12; }
        .action-ì² ìˆ˜ { background: #e74c3c; }
        
        /* JSON ì¶œë ¥ */
        .json-output {
            background: #1a1a2e;
            padding: 15px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            white-space: pre-wrap;
            max-height: 400px;
            overflow-y: auto;
            border: 1px solid #444;
        }
        
        /* ì•Œë¦¼ */
        .alert {
            padding: 12px 20px;
            border-radius: 6px;
            margin-bottom: 15px;
        }
        
        .alert-success {
            background: rgba(39, 174, 96, 0.2);
            border: 1px solid #27ae60;
            color: #27ae60;
        }
        
        .alert-info {
            background: rgba(52, 152, 219, 0.2);
            border: 1px solid #3498db;
            color: #3498db;
        }
        
        /* ê²°ê³¼ ì¹´ë“œ */
        .result-card {
            background: #3d3d5c;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .result-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 1px solid #555;
        }
        
        .result-title {
            font-size: 20px;
            color: #667eea;
        }
        
        .result-date {
            color: #888;
            font-size: 13px;
        }
        
        .trend-list {
            list-style: none;
        }
        
        .trend-item {
            padding: 10px;
            background: #2d2d44;
            border-radius: 6px;
            margin-bottom: 8px;
            border-left: 3px solid #667eea;
        }
        
        .trend-impact {
            font-size: 11px;
            margin-top: 5px;
        }
        
        .score-display {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .score-bar {
            flex: 1;
            height: 8px;
            background: #2d2d44;
            border-radius: 4px;
            overflow: hidden;
        }
        
        .score-fill {
            height: 100%;
            background: linear-gradient(90deg, #e74c3c, #f39c12, #27ae60);
            border-radius: 4px;
        }
        
        .score-value {
            font-weight: bold;
            min-width: 40px;
        }
        
        /* ë¹ˆ ìƒíƒœ */
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #666;
        }
        
        .empty-state-icon {
            font-size: 48px;
            margin-bottom: 15px;
        }
        
        /* ì‚­ì œ ë²„íŠ¼ */
        .delete-btn {
            background: none;
            border: none;
            color: #e74c3c;
            cursor: pointer;
            font-size: 18px;
            padding: 5px;
        }
        
        .delete-btn:hover {
            color: #c0392b;
        }
        
        /* í† ê¸€ ìŠ¤ìœ„ì¹˜ */
        .toggle-switch {
            position: relative;
            width: 50px;
            height: 26px;
        }
        
        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        
        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #555;
            transition: 0.4s;
            border-radius: 26px;
        }
        
        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 20px;
            width: 20px;
            left: 3px;
            bottom: 3px;
            background-color: white;
            transition: 0.4s;
            border-radius: 50%;
        }
        
        input:checked + .toggle-slider {
            background: #667eea;
        }
        
        input:checked + .toggle-slider:before {
            transform: translateX(24px);
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ”¬ Tech Intelligence Config Manager</h1>
        
        <div class="tabs">
            <button class="tab-btn active" onclick="showTab('domains')">ğŸ“ ë¶„ì•¼ ì„¤ì •</button>
            <button class="tab-btn" onclick="showTab('add')">â• ë¶„ì•¼ ì¶”ê°€</button>
            <button class="tab-btn" onclick="showTab('results')">ğŸ“Š ë¶„ì„ ê²°ê³¼</button>
            <button class="tab-btn" onclick="showTab('export')">ğŸ’¾ Export/Import</button>
            <button class="btn btn-primary" onclick="runAnalysis()" style="margin-left: auto;" id="run-btn">ğŸš€ ë¶„ì„ ì‹¤í–‰</button>
        </div>
        
        <!-- ë¶„ì•¼ ì„¤ì • íƒ­ -->
        <div id="tab-domains" class="tab-content active">
            <div id="domains-list">
                <!-- ë™ì ìœ¼ë¡œ ì±„ì›Œì§ -->
            </div>
        </div>
        
        <!-- ë¶„ì•¼ ì¶”ê°€ íƒ­ -->
        <div id="tab-add" class="tab-content">
            <h3 style="margin-bottom: 20px;">ìƒˆ ë¶„ì•¼ ì¶”ê°€</h3>
            <form id="add-domain-form">
                <div class="form-row">
                    <div class="form-group">
                        <label>ë¶„ì•¼ ID (ì˜ë¬¸, ì˜ˆ: CNT-BAT)</label>
                        <input type="text" id="new-id" required placeholder="EMI-ESD">
                    </div>
                    <div class="form-group">
                        <label>ë¶„ì•¼ëª… (í•œê¸€)</label>
                        <input type="text" id="new-name" required placeholder="EMI/ESD ì°¨í">
                    </div>
                </div>
                
                <div class="form-group">
                    <label>ë¶„ì•¼ ì„¤ëª…</label>
                    <input type="text" id="new-desc" placeholder="CNT ê¸°ë°˜ ì „ìíŒŒ ì°¨í ì†Œì¬">
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label>ìš°ë¦¬ ì—­ëŸ‰</label>
                        <select id="new-capability">
                            <option value="í•µì‹¬">í•µì‹¬ (ì§ì ‘ ê´€ë ¨)</option>
                            <option value="ë†’ìŒ">ë†’ìŒ (ì—­ëŸ‰ í™œìš© ê°€ëŠ¥)</option>
                            <option value="ì¤‘ê°„">ì¤‘ê°„ (ì¼ë¶€ ì—­ëŸ‰ í•„ìš”)</option>
                            <option value="ë‚®ìŒ">ë‚®ìŒ (ì‹ ê·œ ì—­ëŸ‰ í•„ìš”)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>ì „ëµ ìš°ì„ ìˆœìœ„ (1=ìµœê³ )</label>
                        <input type="number" id="new-priority" min="1" max="10" value="5">
                    </div>
                </div>
                
                <div class="form-group">
                    <label>ê²€ìƒ‰ í‚¤ì›Œë“œ (í•œêµ­ì–´, ì‰¼í‘œë¡œ êµ¬ë¶„)</label>
                    <textarea id="new-keywords-kr" placeholder="EMI ì°¨í, ì „ìíŒŒ ì°¨í, CNT ì‹¤ë”©"></textarea>
                </div>
                
                <div class="form-group">
                    <label>ê²€ìƒ‰ í‚¤ì›Œë“œ (ì˜ì–´, ì‰¼í‘œë¡œ êµ¬ë¶„)</label>
                    <textarea id="new-keywords-en" placeholder="EMI shielding, CNT electromagnetic, ESD protection"></textarea>
                </div>
                
                <div class="form-group">
                    <label>ì£¼ìš” ê²½ìŸì‚¬/í”Œë ˆì´ì–´ (ì‰¼í‘œë¡œ êµ¬ë¶„)</label>
                    <textarea id="new-competitors" placeholder="íšŒì‚¬A, íšŒì‚¬B, ì—°êµ¬ì†ŒC"></textarea>
                </div>
                
                <div class="btn-group">
                    <button type="submit" class="btn btn-primary">â• ë¶„ì•¼ ì¶”ê°€</button>
                    <button type="reset" class="btn btn-secondary">ì´ˆê¸°í™”</button>
                </div>
            </form>
        </div>
        
        <!-- ë¶„ì„ ê²°ê³¼ íƒ­ -->
        <div id="tab-results" class="tab-content">
            <div class="btn-group" style="margin-bottom: 20px;">
                <button class="btn btn-primary" onclick="addSampleResult()">ğŸ“ ìƒ˜í”Œ ê²°ê³¼ ì¶”ê°€ (í…ŒìŠ¤íŠ¸ìš©)</button>
                <button class="btn btn-secondary" onclick="clearResults()">ğŸ—‘ï¸ ê²°ê³¼ ì´ˆê¸°í™”</button>
            </div>
            
            <div id="results-list">
                <!-- ë™ì ìœ¼ë¡œ ì±„ì›Œì§ -->
            </div>
        </div>
        
        <!-- Export/Import íƒ­ -->
        <div id="tab-export" class="tab-content">
            <h3 style="margin-bottom: 20px;">ì„¤ì • Export (n8nìš© JSON)</h3>
            <p style="color: #888; margin-bottom: 15px;">ì´ JSONì„ n8nì˜ HTTP Request ë˜ëŠ” Read File ë…¸ë“œì—ì„œ ì‚¬ìš©í•˜ì„¸ìš”.</p>
            
            <div class="json-output" id="json-output"></div>
            
            <div class="btn-group">
                <button class="btn btn-primary" onclick="downloadConfig()">â¬‡ï¸ JSON ë‹¤ìš´ë¡œë“œ</button>
                <button class="btn btn-success" onclick="copyToClipboard()">ğŸ“‹ í´ë¦½ë³´ë“œ ë³µì‚¬</button>
            </div>
            
            <h3 style="margin: 30px 0 20px;">ì„¤ì • Import</h3>
            <div class="form-group">
                <label>JSON íŒŒì¼ ì„ íƒ ë˜ëŠ” ë¶™ì—¬ë„£ê¸°</label>
                <input type="file" id="import-file" accept=".json" onchange="importFromFile(event)">
                <textarea id="import-text" placeholder="ë˜ëŠ” ì—¬ê¸°ì— JSONì„ ë¶™ì—¬ë„£ìœ¼ì„¸ìš”..." style="margin-top: 10px;"></textarea>
            </div>
            <button class="btn btn-primary" onclick="importConfig()">ğŸ“¥ Import</button>
            
            <h3 style="margin: 30px 0 20px;">ë¶„ì„ ê²°ê³¼ Export</h3>
            <div class="json-output" id="results-json-output"></div>
            <div class="btn-group">
                <button class="btn btn-primary" onclick="downloadResults()">â¬‡ï¸ ê²°ê³¼ JSON ë‹¤ìš´ë¡œë“œ</button>
            </div>
        </div>
    </div>

    <script>
        // ì´ˆê¸° ë°ì´í„°
        let configData = {
            domains: [
                {
                    id: "CNT-BAT",
                    name: "CNT ë°°í„°ë¦¬",
                    description: "CNTë¥¼ ë„ì „ì¬ë¡œ í™œìš©í•œ ë¦¬íŠ¬ì´ì˜¨ ë°°í„°ë¦¬",
                    capability: "í•µì‹¬",
                    priority: 1,
                    active: true,
                    keywords_kr: ["CNT ë°°í„°ë¦¬", "íƒ„ì†Œë‚˜ë…¸íŠœë¸Œ ë„ì „ì¬", "CNT ìŠ¬ëŸ¬ë¦¬", "CNT ë¶„ì‚°"],
                    keywords_en: ["CNT battery", "carbon nanotube conductive additive", "CNT slurry"],
                    competitors: ["LGì—ë„ˆì§€ì†”ë£¨ì…˜", "ì‚¼ì„±SDI", "CATL", "Nanocyl"]
                },
                {
                    id: "EMI-ESD",
                    name: "EMI/ESD ì°¨í",
                    description: "CNT ê¸°ë°˜ ì „ìíŒŒ ì°¨í ì†Œì¬",
                    capability: "ë†’ìŒ",
                    priority: 2,
                    active: true,
                    keywords_kr: ["EMI ì°¨í", "ì „ìíŒŒ ì°¨í", "CNT ì‹¤ë”©", "ESD ë³´í˜¸"],
                    keywords_en: ["EMI shielding", "CNT electromagnetic", "ESD protection"],
                    competitors: ["Toray", "3M", "Henkel"]
                },
                {
                    id: "DRY-ELE",
                    name: "ê±´ì‹ì „ê·¹",
                    description: "ìš©ë§¤ ì—†ëŠ” ê±´ì‹ ì „ê·¹ ì œì¡° ê¸°ìˆ ",
                    capability: "ì¤‘ê°„",
                    priority: 3,
                    active: true,
                    keywords_kr: ["ê±´ì‹ì „ê·¹", "ë“œë¼ì´ì „ê·¹", "ë¬´ìš©ë§¤ ì „ê·¹", "ê±´ì‹ ê³µì •"],
                    keywords_en: ["dry electrode", "solvent-free electrode", "dry battery manufacturing"],
                    competitors: ["Tesla", "Maxwell", "24M"]
                },
                {
                    id: "TIM",
                    name: "ë°©ì—´ì†Œì¬",
                    description: "ì—´ê³„ë©´ ì†Œì¬ (Thermal Interface Material)",
                    capability: "ë‚®ìŒ",
                    priority: 4,
                    active: false,
                    keywords_kr: ["ë°©ì—´ì†Œì¬", "TIM", "ì—´ì „ë„", "CNT ë°©ì—´"],
                    keywords_en: ["thermal interface material", "CNT thermal", "heat dissipation"],
                    competitors: ["Dow", "Henkel", "Shin-Etsu"]
                },
                {
                    id: "LTO",
                    name: "LTO ë°°í„°ë¦¬",
                    description: "ë¦¬íŠ¬í‹°íƒ€ë„¤ì´íŠ¸ ìŒê·¹ ë°°í„°ë¦¬",
                    capability: "ì¤‘ê°„",
                    priority: 5,
                    active: false,
                    keywords_kr: ["LTO ë°°í„°ë¦¬", "ë¦¬íŠ¬í‹°íƒ€ë„¤ì´íŠ¸", "LTO ìŒê·¹"],
                    keywords_en: ["LTO battery", "lithium titanate", "LTO anode"],
                    competitors: ["Toshiba", "Altairnano", "LeclanchÃ©"]
                }
            ],
            lastUpdated: new Date().toISOString()
        };
        
        let analysisResults = [];
        
        // ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', () => {
            loadFromStorage();
            renderDomains();
            renderResults();
            updateJsonOutput();
        });
        
        // íƒ­ ì „í™˜
        function showTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            
            document.getElementById('tab-' + tabName).classList.add('active');
            event.target.classList.add('active');
            
            if (tabName === 'export') {
                updateJsonOutput();
            }
        }
        
        // ë¶„ì•¼ ëª©ë¡ ë Œë”ë§
        function renderDomains() {
            const container = document.getElementById('domains-list');
            
            if (configData.domains.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">ğŸ“</div>
                        <p>ë“±ë¡ëœ ë¶„ì•¼ê°€ ì—†ìŠµë‹ˆë‹¤.</p>
                        <p style="margin-top: 10px;">"ë¶„ì•¼ ì¶”ê°€" íƒ­ì—ì„œ ìƒˆ ë¶„ì•¼ë¥¼ ì¶”ê°€í•˜ì„¸ìš”.</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = configData.domains.map((domain, index) => `
                <div class="domain-card" style="opacity: ${domain.active ? 1 : 0.5}">
                    <div class="domain-header">
                        <div>
                            <span class="domain-name">${domain.name}</span>
                            <span style="color: #888; margin-left: 10px;">(${domain.id})</span>
                        </div>
                        <div style="display: flex; align-items: center; gap: 15px;">
                            <span class="domain-priority">ìš°ì„ ìˆœìœ„ ${domain.priority}</span>
                            <label class="toggle-switch">
                                <input type="checkbox" ${domain.active ? 'checked' : ''} onchange="toggleDomain(${index})">
                                <span class="toggle-slider"></span>
                            </label>
                            <button class="delete-btn" onclick="deleteDomain(${index})">ğŸ—‘ï¸</button>
                        </div>
                    </div>
                    <p style="color: #aaa; margin-bottom: 10px;">${domain.description}</p>
                    <div class="domain-details">
                        <div class="detail-item">
                            <div class="detail-label">ìš°ë¦¬ ì—­ëŸ‰</div>
                            <div class="detail-value">${domain.capability}</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">í‚¤ì›Œë“œ (KR)</div>
                            <div class="detail-value">${domain.keywords_kr.slice(0, 3).join(', ')}${domain.keywords_kr.length > 3 ? '...' : ''}</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">ê²½ìŸì‚¬</div>
                            <div class="detail-value">${domain.competitors.slice(0, 3).join(', ')}${domain.competitors.length > 3 ? '...' : ''}</div>
                        </div>
                    </div>
                </div>
            `).join('');
        }
        
        // ë¶„ì•¼ ì¶”ê°€
        document.getElementById('add-domain-form').addEventListener('submit', (e) => {
            e.preventDefault();
            
            const newDomain = {
                id: document.getElementById('new-id').value.toUpperCase(),
                name: document.getElementById('new-name').value,
                description: document.getElementById('new-desc').value,
                capability: document.getElementById('new-capability').value,
                priority: parseInt(document.getElementById('new-priority').value),
                active: true,
                keywords_kr: document.getElementById('new-keywords-kr').value.split(',').map(k => k.trim()).filter(k => k),
                keywords_en: document.getElementById('new-keywords-en').value.split(',').map(k => k.trim()).filter(k => k),
                competitors: document.getElementById('new-competitors').value.split(',').map(k => k.trim()).filter(k => k)
            };
            
            // ì¤‘ë³µ ì²´í¬
            if (configData.domains.some(d => d.id === newDomain.id)) {
                alert('ì´ë¯¸ ì¡´ì¬í•˜ëŠ” ë¶„ì•¼ IDì…ë‹ˆë‹¤.');
                return;
            }
            
            configData.domains.push(newDomain);
            configData.lastUpdated = new Date().toISOString();
            
            saveToStorage();
            renderDomains();
            updateJsonOutput();
            
            e.target.reset();
            alert('ë¶„ì•¼ê°€ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤!');
            showTab('domains');
        });
        
        // ë¶„ì•¼ í™œì„±í™” í† ê¸€
        function toggleDomain(index) {
            configData.domains[index].active = !configData.domains[index].active;
            configData.lastUpdated = new Date().toISOString();
            saveToStorage();
            renderDomains();
            updateJsonOutput();
        }
        
        // ë¶„ì•¼ ì‚­ì œ
        function deleteDomain(index) {
            if (confirm(`"${configData.domains[index].name}" ë¶„ì•¼ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
                configData.domains.splice(index, 1);
                configData.lastUpdated = new Date().toISOString();
                saveToStorage();
                renderDomains();
                updateJsonOutput();
            }
        }
        
        // ê²°ê³¼ ë Œë”ë§
        function renderResults() {
            const container = document.getElementById('results-list');
            
            if (analysisResults.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">ğŸ“Š</div>
                        <p>ë¶„ì„ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.</p>
                        <p style="margin-top: 10px;">n8n íŒŒì´í”„ë¼ì¸ ì‹¤í–‰ í›„ ê²°ê³¼ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤.</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = analysisResults.map((result, index) => `
                <div class="result-card">
                    <div class="result-header">
                        <div class="result-title">${result.domain_name}</div>
                        <div>
                            <span class="result-date">${result.analysis_date}</span>
                            <button class="delete-btn" onclick="deleteResult(${index})" style="margin-left: 10px;">ğŸ—‘ï¸</button>
                        </div>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px;">
                        <div>
                            <h4 style="color: #667eea; margin-bottom: 10px;">ğŸ“ˆ í•µì‹¬ íŠ¸ë Œë“œ</h4>
                            <ul class="trend-list">
                                ${(result.key_trends || []).map(t => `
                                    <li class="trend-item">
                                        <strong>${t.trend}</strong>
                                        <div class="trend-impact">
                                            ì˜í–¥ë„: <span class="badge badge-${t.impact_level}">${t.impact_level}</span>
                                            | ì‹œì : ${t.time_horizon}
                                        </div>
                                    </li>
                                `).join('')}
                            </ul>
                        </div>
                        
                        <div>
                            <h4 style="color: #667eea; margin-bottom: 10px;">ğŸ¯ ë‚´ë¶€ í‰ê°€</h4>
                            <div class="detail-item" style="margin-bottom: 10px;">
                                <div class="detail-label">ì¶”ì²œ ì•¡ì…˜</div>
                                <div class="detail-value">
                                    <span class="action-badge action-${result.recommended_action}">${result.recommended_action}</span>
                                </div>
                            </div>
                            <div class="detail-item" style="margin-bottom: 10px;">
                                <div class="detail-label">ì „ëµ ì í•©ë„</div>
                                <div class="score-display">
                                    <div class="score-bar">
                                        <div class="score-fill" style="width: ${result.strategic_fit * 10}%"></div>
                                    </div>
                                    <span class="score-value">${result.strategic_fit}/10</span>
                                </div>
                            </div>
                            <div class="detail-item">
                                <div class="detail-label">ë¶„ì„ ì‹ ë¢°ë„</div>
                                <div class="score-display">
                                    <div class="score-bar">
                                        <div class="score-fill" style="width: ${result.confidence_score * 10}%"></div>
                                    </div>
                                    <span class="score-value">${result.confidence_score}/10</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    ${result.opportunities && result.opportunities.length > 0 ? `
                    <div style="margin-top: 20px;">
                        <h4 style="color: #27ae60; margin-bottom: 10px;">âœ… ê¸°íšŒ</h4>
                        <div style="display: flex; flex-wrap: wrap; gap: 8px;">
                            ${result.opportunities.map(o => `<span class="badge" style="background: rgba(39,174,96,0.3);">${o}</span>`).join('')}
                        </div>
                    </div>
                    ` : ''}
                    
                    ${result.threats && result.threats.length > 0 ? `
                    <div style="margin-top: 15px;">
                        <h4 style="color: #e74c3c; margin-bottom: 10px;">âš ï¸ ìœ„í˜‘</h4>
                        <div style="display: flex; flex-wrap: wrap; gap: 8px;">
                            ${result.threats.map(t => `<span class="badge" style="background: rgba(231,76,60,0.3);">${t}</span>`).join('')}
                        </div>
                    </div>
                    ` : ''}
                </div>
            `).join('');
        }
        
        // ìƒ˜í”Œ ê²°ê³¼ ì¶”ê°€ (í…ŒìŠ¤íŠ¸ìš©)
        function addSampleResult() {
            const sampleResult = {
                domain_id: "CNT-BAT",
                domain_name: "CNT ë°°í„°ë¦¬",
                analysis_date: new Date().toISOString().split('T')[0],
                key_trends: [
                    { trend: "ì „ê³ ì²´ ë°°í„°ë¦¬ CNT ì ìš© í™•ëŒ€", impact_level: "high", time_horizon: "1ë…„ë‚´" },
                    { trend: "ì‹¤ë¦¬ì½˜ ìŒê·¹ CNT ë³µí•©ì²´ ì—°êµ¬ ì¦ê°€", impact_level: "medium", time_horizon: "3ë…„ë‚´" },
                    { trend: "CNT ë¶„ì‚° ê¸°ìˆ  í‘œì¤€í™” ì›€ì§ì„", impact_level: "medium", time_horizon: "ì¦‰ì‹œ" }
                ],
                recommended_action: "ì ê·¹ì§„ì¶œ",
                strategic_fit: 8.5,
                confidence_score: 7.8,
                opportunities: ["ì „ê³ ì²´ ì‹œì¥ ì„ ì ", "ê¸°ì¡´ ë¶„ì‚° ê¸°ìˆ  í™œìš©", "ì£¼ìš” ë°°í„°ë¦¬ì‚¬ í˜‘ë ¥ ê°€ëŠ¥"],
                threats: ["ì¤‘êµ­ ì—…ì²´ ê°€ê²© ê²½ìŸ", "ëŒ€ì²´ ë„ì „ì¬ (ê·¸ë˜í•€) ë¶€ìƒ"]
            };
            
            analysisResults.unshift(sampleResult);
            saveToStorage();
            renderResults();
            updateJsonOutput();
        }
        
        // ê²°ê³¼ ì‚­ì œ
        function deleteResult(index) {
            if (confirm('ì´ ë¶„ì„ ê²°ê³¼ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                analysisResults.splice(index, 1);
                saveToStorage();
                renderResults();
            }
        }
        
        // ê²°ê³¼ ì´ˆê¸°í™”
        function clearResults() {
            if (confirm('ëª¨ë“  ë¶„ì„ ê²°ê³¼ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                analysisResults = [];
                saveToStorage();
                renderResults();
            }
        }
        
        // JSON ì¶œë ¥ ì—…ë°ì´íŠ¸
        function updateJsonOutput() {
            const exportData = {
                ...configData,
                activeDomains: configData.domains.filter(d => d.active)
            };
            document.getElementById('json-output').textContent = JSON.stringify(exportData, null, 2);
            document.getElementById('results-json-output').textContent = JSON.stringify(analysisResults, null, 2);
        }
        
        // JSON ë‹¤ìš´ë¡œë“œ
        function downloadConfig() {
            const blob = new Blob([JSON.stringify(configData, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `tech_intelligence_config_${new Date().toISOString().split('T')[0]}.json`;
            a.click();
            URL.revokeObjectURL(url);
        }
        
        // ê²°ê³¼ ë‹¤ìš´ë¡œë“œ
        function downloadResults() {
            const blob = new Blob([JSON.stringify(analysisResults, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `analysis_results_${new Date().toISOString().split('T')[0]}.json`;
            a.click();
            URL.revokeObjectURL(url);
        }
        
        // í´ë¦½ë³´ë“œ ë³µì‚¬
        function copyToClipboard() {
            navigator.clipboard.writeText(JSON.stringify(configData, null, 2))
                .then(() => alert('í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!'))
                .catch(() => alert('ë³µì‚¬ ì‹¤íŒ¨. ìˆ˜ë™ìœ¼ë¡œ ë³µì‚¬í•´ì£¼ì„¸ìš”.'));
        }
        
        // Import
        function importConfig() {
            const text = document.getElementById('import-text').value;
            if (!text) {
                alert('JSONì„ ì…ë ¥í•˜ê±°ë‚˜ íŒŒì¼ì„ ì„ íƒí•´ì£¼ì„¸ìš”.');
                return;
            }
            
            try {
                const imported = JSON.parse(text);
                if (imported.domains && Array.isArray(imported.domains)) {
                    configData = imported;
                    saveToStorage();
                    renderDomains();
                    updateJsonOutput();
                    alert('Import ì™„ë£Œ!');
                    document.getElementById('import-text').value = '';
                } else {
                    alert('ì˜¬ë°”ë¥¸ ì„¤ì • JSON í˜•ì‹ì´ ì•„ë‹™ë‹ˆë‹¤.');
                }
            } catch (e) {
                alert('JSON íŒŒì‹± ì˜¤ë¥˜: ' + e.message);
            }
        }
        
        function importFromFile(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = (e) => {
                    document.getElementById('import-text').value = e.target.result;
                };
                reader.readAsText(file);
            }
        }
        
        // LocalStorage
        function saveToStorage() {
            localStorage.setItem('techIntelConfig', JSON.stringify(configData));
            localStorage.setItem('techIntelResults', JSON.stringify(analysisResults));
        }
        
        function loadFromStorage() {
            const savedConfig = localStorage.getItem('techIntelConfig');
            const savedResults = localStorage.getItem('techIntelResults');
            
            if (savedConfig) {
                try {
                    configData = JSON.parse(savedConfig);
                } catch (e) {
                    console.error('Config load error:', e);
                }
            }
            
            if (savedResults) {
                try {
                    analysisResults = JSON.parse(savedResults);
                } catch (e) {
                    console.error('Results load error:', e);
                }
            }
        }
        
        // n8nì—ì„œ ê²°ê³¼ ìˆ˜ì‹  (postMessage API)
        window.addEventListener('message', (event) => {
            if (event.data && event.data.type === 'analysisResult') {
                analysisResults.unshift(event.data.result);
                saveToStorage();
                renderResults();
                updateJsonOutput();
            }
        });
        
        // URL íŒŒë¼ë¯¸í„°ë¡œ ê²°ê³¼ ìˆ˜ì‹  (n8n webhook ì—°ë™ìš©)
        const urlParams = new URLSearchParams(window.location.search);
        if (urlParams.has('result')) {
            try {
                const result = JSON.parse(decodeURIComponent(urlParams.get('result')));
                analysisResults.unshift(result);
                saveToStorage();
                renderResults();
                window.history.replaceState({}, document.title, window.location.pathname);
            } catch (e) {
                console.error('URL result parse error:', e);
            }
        }
        
        // ========== n8n Webhook ì—°ë™ ==========
        const N8N_WEBHOOK_URL = 'https://shinkim99.app.n8n.cloud/webhook/tech-intel-run';
        
        async function runAnalysis() {
            const btn = document.getElementById('run-btn');
            const originalText = btn.innerHTML;
            
            // í™œì„±í™”ëœ ë¶„ì•¼ë§Œ ì „ì†¡
            const activeDomains = configData.domains.filter(d => d.active);
            
            if (activeDomains.length === 0) {
                alert('í™œì„±í™”ëœ ë¶„ì•¼ê°€ ì—†ìŠµë‹ˆë‹¤. ë¶„ì•¼ ì„¤ì •ì—ì„œ í™œì„±í™”í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            btn.innerHTML = 'â³ ë¶„ì„ ì¤‘...';
            btn.disabled = true;
            
            try {
                const response = await fetch(N8N_WEBHOOK_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        domains: activeDomains,
                        requested_at: new Date().toISOString()
                    })
                });
                
                if (!response.ok) {
                    throw new Error('ë¶„ì„ ìš”ì²­ ì‹¤íŒ¨: ' + response.status);
                }
                
                const result = await response.json();
                console.log('ë¶„ì„ ê²°ê³¼:', result);
                
                // ê²°ê³¼ ì €ì¥
                if (result.results && Array.isArray(result.results)) {
                    result.results.forEach(r => {
                        analysisResults.unshift({
                            ...r,
                            analysis_date: r.analysis_date || new Date().toISOString().split('T')[0]
                        });
                    });
                } else if (result.saved_at) {
                    // Save Results í˜•íƒœë¡œ ì˜¨ ê²½ìš°
                    if (result.results) {
                        result.results.forEach(r => analysisResults.unshift(r));
                    }
                } else {
                    // ë‹¨ì¼ ê²°ê³¼
                    analysisResults.unshift(result);
                }
                
                saveToStorage();
                renderResults();
                updateJsonOutput();
                
                // ê²°ê³¼ íƒ­ìœ¼ë¡œ ì´ë™
                showTab('results');
                document.querySelector('.tab-btn:nth-child(3)').classList.add('active');
                document.querySelector('.tab-btn:nth-child(1)').classList.remove('active');
                
                alert('ë¶„ì„ ì™„ë£Œ! ' + activeDomains.length + 'ê°œ ë¶„ì•¼ ë¶„ì„ë¨');
                
            } catch (error) {
                console.error('ë¶„ì„ ì˜¤ë¥˜:', error);
                alert('ë¶„ì„ ì‹¤íŒ¨: ' + error.message + '\n\nn8n ì›Œí¬í”Œë¡œìš°ê°€ Published ìƒíƒœì¸ì§€ í™•ì¸í•˜ì„¸ìš”.');
            } finally {
                btn.innerHTML = originalText;
                btn.disabled = false;
            }
        }
    </script>
</body>
</html>
